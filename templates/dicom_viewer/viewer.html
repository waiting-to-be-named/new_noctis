<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noctis - Professional DICOM Viewer</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/dicom_viewer.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="dicom-viewer">
        <!-- Professional Header -->
        <div class="viewer-header">
            <div class="viewer-title">
                <i class="fas fa-x-ray"></i>
                Noctis DICOM Viewer
            </div>
            <div class="viewer-controls">
                <button class="tool-btn" id="upload-btn" title="Upload DICOM Files">
                    <i class="fas fa-upload"></i>
                    Upload
                </button>
                <button class="tool-btn" id="worklist-btn" title="View Worklist">
                    <i class="fas fa-list"></i>
                    Worklist
                </button>
                <button class="tool-btn" id="logout-btn" title="Logout">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </button>
            </div>
        </div>

        <!-- Professional Toolbar -->
        <div class="toolbar">
            <div class="tool-group">
                <button class="tool-btn active" id="windowing-btn" title="Window/Level Tool">
                    <i class="fas fa-adjust"></i>
                    Window
                </button>
                <button class="tool-btn" id="pan-btn" title="Pan Tool">
                    <i class="fas fa-arrows-alt"></i>
                    Pan
                </button>
                <button class="tool-btn" id="zoom-btn" title="Zoom Tool">
                    <i class="fas fa-search"></i>
                    Zoom
                </button>
                <button class="tool-btn" id="measure-btn" title="Measurement Tool">
                    <i class="fas fa-ruler"></i>
                    Measure
                </button>
            </div>

            <div class="tool-group">
                <button class="tool-btn" id="crosshair-btn" title="Toggle Crosshair">
                    <i class="fas fa-crosshairs"></i>
                    Crosshair
                </button>
                <button class="tool-btn" id="invert-btn" title="Invert Image">
                    <i class="fas fa-adjust"></i>
                    Invert
                </button>
                <button class="tool-btn" id="reset-btn" title="Reset View">
                    <i class="fas fa-undo"></i>
                    Reset
                </button>
            </div>

            <div class="tool-group">
                <button class="tool-btn" id="preset-btn" title="Window Presets">
                    <i class="fas fa-sliders-h"></i>
                    Presets
                </button>
                <button class="tool-btn" id="enhance-btn" title="Image Enhancement">
                    <i class="fas fa-magic"></i>
                    Enhance
                </button>
                <button class="tool-btn" id="ai-btn" title="AI Analysis">
                    <i class="fas fa-brain"></i>
                    AI
                </button>
            </div>

            <div class="tool-group">
                <button class="tool-btn" id="3d-btn" title="3D Reconstruction">
                    <i class="fas fa-cube"></i>
                    3D
                </button>
                <button class="tool-btn" id="series-btn" title="Series Selector">
                    <i class="fas fa-layer-group"></i>
                    Series
                </button>
                <button class="tool-btn" id="report-btn" title="Generate Report">
                    <i class="fas fa-file-medical"></i>
                    Report
                </button>
            </div>
        </div>

        <!-- Professional Patient Info -->
        <div class="patient-info">
            <div class="patient-info-item">
                <span class="patient-info-label">Patient:</span>
                <span class="patient-info-value" id="patient-name">-</span>
            </div>
            <div class="patient-info-item">
                <span class="patient-info-label">ID:</span>
                <span class="patient-info-value" id="patient-id">-</span>
            </div>
            <div class="patient-info-item">
                <span class="patient-info-label">Study:</span>
                <span class="patient-info-value" id="study-description">-</span>
            </div>
            <div class="patient-info-item">
                <span class="patient-info-label">Date:</span>
                <span class="patient-info-value" id="study-date">-</span>
            </div>
            <div class="patient-info-item">
                <span class="patient-info-label">Modality:</span>
                <span class="patient-info-value" id="modality">-</span>
            </div>
            <div class="patient-info-item">
                <span class="patient-info-label">Images:</span>
                <span class="patient-info-value" id="image-count">-</span>
            </div>
        </div>

        <!-- Professional Viewport Container -->
        <div class="viewport-container">
            <div class="viewport">
                <canvas id="dicom-canvas" width="800" height="600"></canvas>
                
                <!-- Quality Indicator -->
                <div class="quality-indicator">
                    <i class="fas fa-check-circle"></i>
                    Diagnostic Quality
                </div>

                <!-- Overlay Labels -->
                <div class="overlay-label top-left" id="wl-info">
                    <strong>Window/Level:</strong><br>
                    Width: <span id="ww-value">1500</span><br>
                    Level: <span id="wl-value">-600</span>
                </div>

                <div class="overlay-label top-right" id="zoom-info">
                    <strong>Zoom:</strong> <span id="zoom-value">100%</span><br>
                    <strong>Position:</strong> <span id="position-info">-</span>
                </div>

                <!-- Crosshair -->
                <div class="crosshair" id="crosshair" style="display: none;">
                    <div class="crosshair-horizontal"></div>
                    <div class="crosshair-vertical"></div>
                </div>
            </div>
        </div>

        <!-- Professional Slider Controls -->
        <div class="slider-controls">
            <div class="slider-control">
                <label>Window Width</label>
                <input type="range" id="window-width-slider" min="1" max="4000" value="1500" step="1">
                <div class="value" id="window-width-value">1500</div>
            </div>
            <div class="slider-control">
                <label>Window Level</label>
                <input type="range" id="window-level-slider" min="-2000" max="2000" value="-600" step="1">
                <div class="value" id="window-level-value">-600</div>
            </div>
            <div class="slider-control">
                <label>Zoom</label>
                <input type="range" id="zoom-slider" min="10" max="500" value="100" step="1">
                <div class="value" id="zoom-slider-value">100%</div>
            </div>
        </div>

        <!-- Professional Status Bar -->
        <div class="status-bar">
            <div class="status-item">
                <i class="fas fa-image"></i>
                <span id="current-image-info">No image loaded</span>
            </div>
            <div class="status-item">
                <i class="fas fa-tools"></i>
                <span id="current-tool">Window/Level</span>
            </div>
            <div class="status-item">
                <i class="fas fa-clock"></i>
                <span id="processing-status">Ready</span>
            </div>
        </div>
    </div>

    <!-- Professional Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loading-text">Loading...</div>
    </div>

    <!-- Professional Upload Modal -->
    <div class="modal" id="upload-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Upload DICOM Files</h3>
                <button class="modal-close" id="close-upload-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="upload-tabs">
                    <button class="upload-tab active" onclick="switchUploadTab('files')">
                        <i class="fas fa-file"></i>
                        Files
                    </button>
                    <button class="upload-tab" onclick="switchUploadTab('folder')">
                        <i class="fas fa-folder"></i>
                        Folder
                    </button>
                    <button class="upload-tab" onclick="switchUploadTab('network')">
                        <i class="fas fa-network-wired"></i>
                        Network
                    </button>
                </div>
                
                <div class="upload-content">
                    <div id="files-tab" class="upload-tab-content active">
                        <div class="upload-drop-area" id="upload-drop-area">
                            <i class="fas fa-cloud-upload-alt upload-icon"></i>
                            <h4>Drop DICOM files here</h4>
                            <p>or click to browse</p>
                            <div class="upload-formats">
                                <span class="format-tag">DICOM</span>
                                <span class="format-tag">ZIP</span>
                                <span class="format-tag">RAR</span>
                            </div>
                        </div>
                        <input type="file" id="file-input" multiple accept=".dcm,.zip,.rar" style="display: none;">
                    </div>
                    
                    <div id="folder-tab" class="upload-tab-content">
                        <div class="upload-drop-area" id="folder-drop-area">
                            <i class="fas fa-folder-open upload-icon"></i>
                            <h4>Drop folder here</h4>
                            <p>or click to browse folder</p>
                        </div>
                        <input type="file" id="folder-input" webkitdirectory directory multiple style="display: none;">
                    </div>
                    
                    <div id="network-tab" class="upload-tab-content">
                        <div class="network-options">
                            <div class="network-option">
                                <h5><i class="fas fa-server"></i> PACS Server</h5>
                                <div class="network-form">
                                    <input type="text" placeholder="Server IP" id="pacs-ip">
                                    <input type="text" placeholder="Port" id="pacs-port" value="104">
                                    <input type="text" placeholder="AE Title" id="pacs-ae">
                                    <button class="network-connect-btn" onclick="connectToPACS()">Connect</button>
                                </div>
                            </div>
                            <div class="network-option">
                                <h5><i class="fas fa-cloud"></i> Cloud Storage</h5>
                                <div class="cloud-providers">
                                    <button class="cloud-btn" onclick="connectToCloud('aws')">
                                        <i class="fab fa-aws"></i>
                                        AWS S3
                                    </button>
                                    <button class="cloud-btn" onclick="connectToCloud('azure')">
                                        <i class="fab fa-microsoft"></i>
                                        Azure
                                    </button>
                                    <button class="cloud-btn" onclick="connectToCloud('gcp')">
                                        <i class="fab fa-google"></i>
                                        GCP
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Professional Series Selector -->
    <div class="series-selector" id="series-selector">
        <div class="series-selector-header">
            <h4 class="series-selector-title">Series Selection</h4>
        </div>
        <div class="series-grid" id="series-grid">
            <!-- Series items will be populated here -->
        </div>
    </div>

    <!-- Professional Enhancement Panel -->
    <div class="enhancement-panel" id="enhancement-panel">
        <h4 class="enhancement-title">Image Enhancement</h4>
        <div class="enhancement-control">
            <label>Brightness</label>
            <input type="range" id="brightness-slider" min="0" max="200" value="100">
        </div>
        <div class="enhancement-control">
            <label>Contrast</label>
            <input type="range" id="contrast-slider" min="0" max="200" value="100">
        </div>
        <div class="enhancement-control">
            <label>Gamma</label>
            <input type="range" id="gamma-slider" min="0.1" max="3.0" value="1.0" step="0.1">
        </div>
        <div class="enhancement-control">
            <label>Sharpness</label>
            <input type="range" id="sharpness-slider" min="0" max="100" value="50">
        </div>
    </div>

    <!-- Professional Notifications Container -->
    <div id="notifications-container"></div>

    <!-- JavaScript -->
    <script src="{% static 'js/dicom_viewer.js' %}"></script>
    <script>
        // Initialize the viewer when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            const viewer = new DicomViewer();
            viewer.init();
        });
    </script>
</body>
</html>