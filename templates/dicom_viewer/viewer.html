<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noctis - DICOM Viewer</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/dicom_viewer.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div id="dicom-viewer" class="dicom-viewer">
        <!-- Left Toolbar -->
        <div class="toolbar">
            <div class="tool-buttons">
                <button class="tool-btn active" data-tool="windowing" title="Window/Level">
                    <i class="fas fa-adjust"></i>
                    <span>Window</span>
                </button>
                <button class="tool-btn" data-tool="zoom" title="Zoom">
                    <i class="fas fa-search-plus"></i>
                    <span>Zoom</span>
                </button>
                <button class="tool-btn" data-tool="pan" title="Pan">
                    <i class="fas fa-hand-paper"></i>
                    <span>Pan</span>
                </button>
                <button class="tool-btn" data-tool="measure" title="Measure">
                    <i class="fas fa-ruler"></i>
                    <span>Measure</span>
                </button>
                <button class="tool-btn" data-tool="ellipse" title="Ellipse HU">
                    <i class="fas fa-circle-notch"></i>
                    <span>Ellipse</span>
                </button>
                <button class="tool-btn" data-tool="annotate" title="Annotate">
                    <i class="fas fa-edit"></i>
                    <span>Annotate</span>
                </button>
                <button class="tool-btn" data-tool="crosshair" title="Crosshair">
                    <i class="fas fa-crosshairs"></i>
                    <span>Crosshair</span>
                </button>
                <button class="tool-btn" data-tool="invert" title="Invert">
                    <i class="fas fa-circle"></i>
                    <span>Invert</span>
                </button>
                <button class="tool-btn" data-tool="reset" title="Reset">
                    <i class="fas fa-undo"></i>
                    <span>Reset</span>
                </button>
                <button class="tool-btn" data-tool="volume" title="Volume Calculation">
                    <i class="fas fa-calculator"></i>
                    <span>Volume</span>
                </button>
                <button class="tool-btn" data-tool="ai" title="AI Analysis">
                    <i class="fas fa-robot"></i>
                    <span>AI</span>
                </button>
                <button class="tool-btn" data-tool="3d" title="3D Reconstruction">
                    <i class="fas fa-cube"></i>
                    <span>3D</span>
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Top Bar -->
            <div class="top-bar">
                <div class="top-controls">
                    <div class="top-left-controls">
                        <button id="worklist-btn" class="secondary-btn" title="Back to Worklist">
                            <i class="fas fa-list"></i>
                            Worklist
                        </button>
                        <button id="load-dicom-btn" class="primary-btn">
                            <i class="fas fa-upload"></i>
                            Load DICOM Files
                        </button>
                        <select id="backend-studies" class="form-select">
                            <option value="">Select DICOM from System</option>
                        </select>
                    </div>
                    
                    <div class="top-center-controls">
                        <div class="patient-info" id="patient-info">
                            Patient: - | Study Date: - | Modality: -
                        </div>
                    </div>
                    
                    <div class="top-right-controls">
                        <!-- Professional 3D Dropdown -->
                        <div class="dropdown-container">
                            <button class="professional-btn dropdown-toggle" id="3d-dropdown">
                                <i class="fas fa-cube"></i>
                                <span>3D Tools</span>
                                <i class="fas fa-chevron-down dropdown-arrow"></i>
                            </button>
                            <div class="dropdown-menu" id="3d-menu">
                                <div class="dropdown-header">
                                    <i class="fas fa-cube"></i>
                                    3D Reconstruction Tools
                                </div>
                                <button class="dropdown-item" data-3d-type="mpr">
                                    <i class="fas fa-layer-group"></i>
                                    <div class="item-content">
                                        <span class="item-title">Multi-Planar Reconstruction</span>
                                        <span class="item-desc">View axial, sagittal & coronal planes</span>
                                    </div>
                                </button>
                                <button class="dropdown-item" data-3d-type="3d_bone">
                                    <i class="fas fa-bone"></i>
                                    <div class="item-content">
                                        <span class="item-title">3D Bone Reconstruction</span>
                                        <span class="item-desc">Volume rendering of bone structures</span>
                                    </div>
                                </button>
                                <button class="dropdown-item" data-3d-type="angiogram">
                                    <i class="fas fa-heartbeat"></i>
                                    <div class="item-content">
                                        <span class="item-title">Angiogram</span>
                                        <span class="item-desc">Maximum intensity projection</span>
                                    </div>
                                </button>
                                <button class="dropdown-item" data-3d-type="virtual_surgery">
                                    <i class="fas fa-user-md"></i>
                                    <div class="item-content">
                                        <span class="item-title">Virtual Surgery</span>
                                        <span class="item-desc">Surgical planning tools</span>
                                    </div>
                                </button>
                            </div>
                        </div>
                        
                        <!-- Professional AI Analysis Dropdown -->
                        <div class="dropdown-container">
                            <button class="professional-btn dropdown-toggle" id="ai-dropdown">
                                <i class="fas fa-robot"></i>
                                <span>AI Analysis</span>
                                <i class="fas fa-chevron-down dropdown-arrow"></i>
                            </button>
                            <div class="dropdown-menu" id="ai-menu">
                                <div class="dropdown-header">
                                    <i class="fas fa-robot"></i>
                                    AI Analysis Tools
                                </div>
                                <button class="dropdown-item" data-ai-type="comprehensive">
                                    <i class="fas fa-brain"></i>
                                    <div class="item-content">
                                        <span class="item-title">Comprehensive Analysis</span>
                                        <span class="item-desc">Full AI diagnosis with recommendations</span>
                                    </div>
                                </button>
                                <button class="dropdown-item" data-ai-type="abnormality">
                                    <i class="fas fa-search-plus"></i>
                                    <div class="item-content">
                                        <span class="item-title">Abnormality Detection</span>
                                        <span class="item-desc">Detect potential abnormalities</span>
                                    </div>
                                </button>
                                <button class="dropdown-item" data-ai-type="texture">
                                    <i class="fas fa-microscope"></i>
                                    <div class="item-content">
                                        <span class="item-title">Texture Analysis</span>
                                        <span class="item-desc">Advanced texture and pattern analysis</span>
                                    </div>
                                </button>
                            </div>
                        </div>
                        
                        <!-- User Account Dropdown -->
                        <div class="dropdown-container">
                            <button class="professional-btn dropdown-toggle user-btn" id="user-dropdown">
                                <i class="fas fa-user"></i>
                                <span id="username">{{ user.get_full_name|default:user.username }}</span>
                                <i class="fas fa-chevron-down dropdown-arrow"></i>
                            </button>
                            <div class="dropdown-menu" id="user-menu">
                                <div class="dropdown-header">
                                    <i class="fas fa-user"></i>
                                    Account Options
                                </div>
                                <div class="dropdown-item user-info-item">
                                    <i class="fas fa-info-circle"></i>
                                    <div class="item-content">
                                        <span class="item-title">{{ user.get_full_name|default:user.username }}</span>
                                        <span class="item-desc">
                                            {% if user.is_superuser %}
                                                System Administrator
                                            {% elif user.groups.all %}
                                                {{ user.groups.first.name }}
                                            {% else %}
                                                User
                                            {% endif %}
                                        </span>
                                    </div>
                                </div>
                                <div class="dropdown-divider"></div>
                                <button class="dropdown-item" onclick="window.location.href='/home/'">
                                    <i class="fas fa-home"></i>
                                    <div class="item-content">
                                        <span class="item-title">Dashboard</span>
                                        <span class="item-desc">Return to main dashboard</span>
                                    </div>
                                </button>
                                {% if user.is_superuser %}
                                <button class="dropdown-item" onclick="window.location.href='/admin/'">
                                    <i class="fas fa-cog"></i>
                                    <div class="item-content">
                                        <span class="item-title">Admin Panel</span>
                                        <span class="item-desc">System administration</span>
                                    </div>
                                </button>
                                {% endif %}
                                <div class="dropdown-divider"></div>
                                <button class="dropdown-item logout-item" onclick="logout()">
                                    <i class="fas fa-sign-out-alt"></i>
                                    <div class="item-content">
                                        <span class="item-title">Logout</span>
                                        <span class="item-desc">Sign out of the system</span>
                                    </div>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="clinical-info-section" id="clinical-info-section" style="display: none;">
                        <div class="clinical-info-header">
                            <h4><i class="fas fa-file-medical"></i> Clinical Information</h4>
                            <button class="btn-toggle" onclick="toggleClinicalInfo()">
                                <i class="fas fa-chevron-up"></i>
                            </button>
                        </div>
                        <div class="clinical-info-content" id="clinical-info-content">
                            <p id="clinical-info-text">No clinical information available</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Viewport -->
            <div class="viewport">
                <canvas id="dicom-canvas" class="dicom-canvas"></canvas>
                
                <!-- Overlay Labels -->
                <div class="overlay-labels">
                    <div class="wl-info" id="wl-info">
                        WW: 400<br>
                        WL: 40<br>
                        Slice: 1/1
                    </div>
                    <div class="zoom-info" id="zoom-info">
                        Zoom: 100%
                    </div>
                </div>

                <!-- Crosshair -->
                <div id="crosshair" class="crosshair" style="display: none;">
                    <div class="crosshair-h"></div>
                    <div class="crosshair-v"></div>
                </div>
            </div>
        </div>

        <!-- Right Panel -->
        <div class="right-panel">
            <div class="panel-content">
                <!-- Window/Level Section -->
                <div class="panel-section">
                    <h3 class="section-title">Window/Level</h3>
                    
                    <div class="control-group">
                        <div class="control-header">
                            <label>Window Width</label>
                            <span id="ww-value">400</span>
                        </div>
                        <input type="range" id="ww-slider" min="1" max="4000" value="400" class="slider">
                    </div>
                    
                    <div class="control-group">
                        <div class="control-header">
                            <label>Window Level</label>
                            <span id="wl-value">40</span>
                        </div>
                        <input type="range" id="wl-slider" min="-1000" max="1000" value="40" class="slider">
                    </div>
                    
                    <div class="preset-buttons">
                        <button class="preset-btn" data-preset="lung">Lung</button>
                        <button class="preset-btn" data-preset="bone">Bone</button>
                        <button class="preset-btn" data-preset="soft">Soft</button>
                        <button class="preset-btn" data-preset="brain">Brain</button>
                    </div>
                </div>

                <!-- Navigation Section -->
                <div class="panel-section">
                    <h3 class="section-title">Image Navigation</h3>
                    
                    <div class="control-group">
                        <div class="control-header">
                            <label>Slice</label>
                            <span id="slice-value">1</span>
                        </div>
                        <input type="range" id="slice-slider" min="0" max="0" value="0" class="slider">
                    </div>
                </div>

                <!-- Transform Section -->
                <div class="panel-section">
                    <h3 class="section-title">Transform</h3>
                    
                    <div class="control-group">
                        <div class="control-header">
                            <label>Zoom</label>
                            <span id="zoom-value">100%</span>
                        </div>
                        <input type="range" id="zoom-slider" min="25" max="500" value="100" class="slider">
                    </div>
                </div>

                <!-- Image Info Section -->
                <div class="panel-section">
                    <h3 class="section-title">Image Info</h3>
                    <div class="info-list">
                        <div class="info-item">
                            <label>Dimensions:</label>
                            <span id="info-dimensions">-</span>
                        </div>
                        <div class="info-item">
                            <label>Pixel Spacing:</label>
                            <span id="info-pixel-spacing">-</span>
                        </div>
                        <div class="info-item">
                            <label>Series:</label>
                            <span id="info-series">-</span>
                        </div>
                        <div class="info-item">
                            <label>Institution:</label>
                            <span id="info-institution">-</span>
                        </div>
                    </div>
                </div>

                <!-- Measurements Section -->
                <div class="panel-section">
                    <h3 class="section-title">Measurements</h3>
                    <div class="control-group" style="margin-bottom:8px;">
                        <label for="measurement-unit">Unit:</label>
                        <select id="measurement-unit" class="form-select small" style="width:80px;">
                            <option value="mm">mm</option>
                            <option value="cm">cm</option>
                        </select>
                    </div>
                    <button id="clear-measurements" class="secondary-btn">Clear All</button>
                    <div id="measurements-list" class="measurements-list"></div>
                </div>

            </div>
        </div>
    </div>

    <!-- File Upload Modal -->
    <div id="upload-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Upload DICOM Files</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="upload-area" id="upload-area">
                    <i class="fas fa-cloud-upload-alt"></i>
                    <p>Drag and drop DICOM files here or click to select</p>
                    <input type="file" id="file-input" multiple accept=".dcm,.dicom">
                </div>
                <div class="upload-progress" id="upload-progress" style="display: none;">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <p id="progress-text">Uploading...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Hidden file input for DICOM upload -->
    <input type="file" id="hidden-file-input" multiple accept=".dcm,.dicom" style="display: none;">

    <script>
        // Set initial study ID if provided by the backend
        {% if initial_study_id %}
            window.initialStudyId = {{ initial_study_id }};
        {% endif %}
        
        {% if initial_study_error %}
            // Show error if study not found
            setTimeout(() => {
                alert('{{ initial_study_error }}');
            }, 100);
        {% endif %}
        
        // Professional dropdown functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize dropdowns
            initializeDropdowns();
            
            // Initialize 3D tools
            initialize3DTools();
            
            // Initialize AI tools
            initializeAITools();
            
            if (window.initialStudyId) {
                loadClinicalInfo(window.initialStudyId);
            }
        });
        
        function initializeDropdowns() {
            const dropdowns = document.querySelectorAll('.dropdown-container');
            
            dropdowns.forEach(dropdown => {
                const toggle = dropdown.querySelector('.dropdown-toggle');
                const menu = dropdown.querySelector('.dropdown-menu');
                
                // Toggle dropdown
                toggle.addEventListener('click', function(e) {
                    e.stopPropagation();
                    
                    // Close other dropdowns
                    dropdowns.forEach(otherDropdown => {
                        if (otherDropdown !== dropdown) {
                            otherDropdown.querySelector('.dropdown-menu').classList.remove('show');
                            otherDropdown.querySelector('.dropdown-toggle').classList.remove('active');
                        }
                    });
                    
                    // Toggle current dropdown
                    menu.classList.toggle('show');
                    toggle.classList.toggle('active');
                });
                
                // Close dropdown when clicking outside
                document.addEventListener('click', function() {
                    menu.classList.remove('show');
                    toggle.classList.remove('active');
                });
                
                // Prevent dropdown from closing when clicking inside
                menu.addEventListener('click', function(e) {
                    e.stopPropagation();
                });
            });
        }
        
        function initialize3DTools() {
            const threeDItems = document.querySelectorAll('[data-3d-type]');
            
            threeDItems.forEach(item => {
                item.addEventListener('click', function() {
                    const type = this.getAttribute('data-3d-type');
                    perform3DReconstruction(type);
                    
                    // Close dropdown
                    document.getElementById('3d-menu').classList.remove('show');
                    document.getElementById('3d-dropdown').classList.remove('active');
                });
            });
        }
        
        function initializeAITools() {
            const aiItems = document.querySelectorAll('[data-ai-type]');
            
            aiItems.forEach(item => {
                item.addEventListener('click', function() {
                    const type = this.getAttribute('data-ai-type');
                    performAIAnalysis(type);
                    
                    // Close dropdown
                    document.getElementById('ai-menu').classList.remove('show');
                    document.getElementById('ai-dropdown').classList.remove('active');
                });
            });
        }
        
        function perform3DReconstruction(type) {
            // This will be implemented in the main DICOM viewer JS
            if (window.dicomViewer && window.dicomViewer.perform3DReconstruction) {
                window.dicomViewer.perform3DReconstruction(type);
            } else {
                console.log('3D Reconstruction:', type);
                showNotification(`Starting ${type} reconstruction...`, 'info');
            }
        }
        
        function performAIAnalysis(type) {
            // This will be implemented in the main DICOM viewer JS
            if (window.dicomViewer && window.dicomViewer.performAIAnalysis) {
                window.dicomViewer.performAIAnalysis(type);
            } else {
                console.log('AI Analysis:', type);
                showNotification(`Starting ${type} analysis...`, 'info');
            }
        }
        
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                // Create a form for POST logout
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/logout/';
                
                // Add CSRF token
                const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
                if (csrfToken) {
                    const csrfInput = document.createElement('input');
                    csrfInput.type = 'hidden';
                    csrfInput.name = 'csrfmiddlewaretoken';
                    csrfInput.value = csrfToken.value;
                    form.appendChild(csrfInput);
                }
                
                document.body.appendChild(form);
                form.submit();
            }
        }
        
        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                <span>${message}</span>
            `;
            
            // Add to page
            document.body.appendChild(notification);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 3000);
        }
        
        // Clinical Information functionality
        function toggleClinicalInfo() {
            const content = document.getElementById('clinical-info-content');
            const toggleBtn = document.querySelector('.btn-toggle i');
            const section = document.getElementById('clinical-info-section');
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                toggleBtn.className = 'fas fa-chevron-up';
                section.classList.add('expanded');
            } else {
                content.classList.add('collapsed');
                toggleBtn.className = 'fas fa-chevron-down';
                section.classList.remove('expanded');
            }
        }
        
        // Function to load and display clinical information
        function loadClinicalInfo(studyId) {
            fetch(`/viewer/api/study/${studyId}/clinical-info/`)
                .then(response => response.json())
                .then(data => {
                    const section = document.getElementById('clinical-info-section');
                    const textElement = document.getElementById('clinical-info-text');
                    
                    if (data.clinical_info && data.clinical_info.trim()) {
                        textElement.textContent = data.clinical_info;
                        section.style.display = 'block';
                    } else {
                        textElement.textContent = 'No clinical information available';
                        section.style.display = 'none';
                    }
                })
                .catch(error => {
                    console.error('Error loading clinical info:', error);
                    document.getElementById('clinical-info-section').style.display = 'none';
                });
        }
    </script>
    
    <style>
        /* Professional top bar styling */
        .top-bar {
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
            border-bottom: 2px solid #00ff00;
            padding: 15px 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }
        
        .top-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .top-left-controls,
        .top-center-controls,
        .top-right-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .top-center-controls {
            flex: 1;
            justify-content: center;
        }
        
        /* Professional button styling */
        .professional-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(0, 255, 0, 0.3);
            color: #e0e0e0;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
            min-width: 140px;
            justify-content: space-between;
        }
        
        .professional-btn:hover {
            background: rgba(0, 255, 0, 0.1);
            border-color: #00ff00;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 255, 0, 0.3);
        }
        
        .professional-btn.active {
            background: rgba(0, 255, 0, 0.2);
            border-color: #00ff00;
            color: #00ff00;
        }
        
        .dropdown-arrow {
            transition: transform 0.3s ease;
        }
        
        .professional-btn.active .dropdown-arrow {
            transform: rotate(180deg);
        }
        
        /* Dropdown container */
        .dropdown-container {
            position: relative;
        }
        
        /* Dropdown menu */
        .dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: #1a1a1a;
            border: 2px solid #00ff00;
            border-radius: 12px;
            min-width: 300px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            overflow: hidden;
        }
        
        .dropdown-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .dropdown-header {
            background: linear-gradient(45deg, #00ff00, #00cc00);
            color: #000;
            padding: 15px 20px;
            font-weight: bold;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .dropdown-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px 20px;
            border: none;
            background: none;
            color: #e0e0e0;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            text-align: left;
        }
        
        .dropdown-item:hover {
            background: rgba(0, 255, 0, 0.1);
            color: #00ff00;
        }
        
        .dropdown-item i {
            font-size: 18px;
            width: 24px;
            text-align: center;
        }
        
        .item-content {
            flex: 1;
        }
        
        .item-title {
            display: block;
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }
        
        .item-desc {
            display: block;
            font-size: 12px;
            color: #999;
            line-height: 1.3;
        }
        
        .dropdown-divider {
            height: 1px;
            background: #333;
            margin: 10px 0;
        }
        
        .user-info-item {
            cursor: default !important;
        }
        
        .user-info-item:hover {
            background: none !important;
            color: #e0e0e0 !important;
        }
        
        .logout-item:hover {
            background: rgba(255, 68, 68, 0.1) !important;
            color: #ff4444 !important;
        }
        
        /* User button specific styling */
        .user-btn {
            background: rgba(0, 153, 255, 0.1);
            border-color: rgba(0, 153, 255, 0.3);
        }
        
        .user-btn:hover {
            background: rgba(0, 153, 255, 0.2);
            border-color: #0099ff;
            box-shadow: 0 4px 15px rgba(0, 153, 255, 0.3);
        }
        
        .user-btn.active {
            background: rgba(0, 153, 255, 0.3);
            border-color: #0099ff;
            color: #0099ff;
        }
        
        /* Notification styling */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #1a1a1a;
            border: 2px solid #00ff00;
            border-radius: 8px;
            padding: 15px 20px;
            color: #e0e0e0;
            z-index: 9999;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideIn 0.3s ease;
        }
        
        .notification-error {
            border-color: #ff4444;
            color: #ff4444;
        }
        
        .notification-success {
            border-color: #00ff00;
            color: #00ff00;
        }
        
        .notification-info {
            border-color: #0099ff;
            color: #0099ff;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Responsive adjustments */
        @media (max-width: 1200px) {
            .top-controls {
                flex-direction: column;
                gap: 15px;
            }
            
            .top-left-controls,
            .top-center-controls,
            .top-right-controls {
                width: 100%;
                justify-content: center;
            }
            
            .dropdown-menu {
                right: auto;
                left: 50%;
                transform: translateX(-50%) translateY(-10px);
            }
            
            .dropdown-menu.show {
                transform: translateX(-50%) translateY(0);
            }
        }
        
        /* Patient info enhanced styling */
        .patient-info {
            background: rgba(0, 255, 0, 0.1);
            border: 1px solid rgba(0, 255, 0, 0.3);
            padding: 10px 20px;
            border-radius: 20px;
            font-weight: 500;
            color: #00ff00;
            text-shadow: 0 0 10px rgba(0, 255, 0, 0.3);
            white-space: nowrap;
        }
    </style>
    <script src="{% static 'js/dicom_viewer.js' %}"></script>
</body>
</html>