<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noctis - Professional DICOM Viewer</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/dicom_viewer.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <div class="dicom-viewer">
        <!-- Top Bar - Primary Navigation & Patient Info -->
        <div class="viewer-header">
            <div class="header-left">
                <button class="header-btn" id="worklist-btn" title="View Worklist">
                    <i class="fas fa-list"></i>
                    Worklist
                </button>
                <button class="header-btn" id="load-dicom-btn" title="Load DICOM Files">
                    <i class="fas fa-upload"></i>
                    Load DICOM
                </button>
                <button class="header-btn" id="series-btn" title="Series Selector">
                    <i class="fas fa-layer-group"></i>
                    Series
                </button>
                <button class="header-btn logout-btn" id="logout-btn" title="Logout">
                    <i class="fas fa-sign-out-alt"></i>
                    Logout
                </button>
            </div>
            <div class="header-right">
                <div class="patient-info-display">
                    <span class="patient-info-text">
                        Patient: <span id="patient-name">-</span> | 
                        Study Date: <span id="study-date">-</span> | 
                        Modality: <span id="modality">-</span>
                    </span>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Left Sidebar - Image Tools -->
            <div class="left-sidebar">
                <div class="tool-group">
                    <button class="tool-btn" id="window-btn" title="Window/Level Tool">
                        <i class="fas fa-adjust"></i>
                        Window
                    </button>
                    <button class="tool-btn active" id="zoom-btn" title="Zoom Tool">
                        <i class="fas fa-search"></i>
                        Zoom
                    </button>
                    <button class="tool-btn" id="pan-btn" title="Pan Tool">
                        <i class="fas fa-arrows-alt"></i>
                        Pan
                    </button>
                    <button class="tool-btn" id="measure-btn" title="Measurement Tool">
                        <i class="fas fa-ruler"></i>
                        Measure
                    </button>
                    <button class="tool-btn" id="ellipse-btn" title="Ellipse Measurement">
                        <i class="fas fa-circle"></i>
                        Ellipse
                    </button>
                    <button class="tool-btn" id="annotate-btn" title="Annotation Tool">
                        <i class="fas fa-edit"></i>
                        Annotate
                    </button>
                    <button class="tool-btn" id="crosshair-btn" title="Toggle Crosshair">
                        <i class="fas fa-crosshairs"></i>
                        Crosshair
                    </button>
                    <button class="tool-btn" id="invert-btn" title="Invert Image">
                        <i class="fas fa-adjust"></i>
                        Invert
                    </button>
                </div>
                
                <!-- Crosshair Status -->
                <div class="crosshair-status">
                    <span class="status-label">Crosshair:</span>
                    <span class="status-value" id="crosshair-status">OFF</span>
                </div>
            </div>

            <!-- Central Display Area -->
            <div class="center-viewport">
                <div class="viewport-container">
                    <canvas id="dicom-canvas" width="800" height="600"></canvas>
                    
                    <!-- Image Overlay Information -->
                    <div class="image-overlay top-left">
                        <div class="overlay-item">
                            <span class="overlay-label">WW:</span>
                            <span class="overlay-value" id="ww-display">400</span>
                        </div>
                        <div class="overlay-item">
                            <span class="overlay-label">WL:</span>
                            <span class="overlay-value" id="wl-display">40</span>
                        </div>
                        <div class="overlay-item">
                            <span class="overlay-label">Slice:</span>
                            <span class="overlay-value" id="slice-display">1/1</span>
                        </div>
                    </div>
                    
                    <div class="image-overlay bottom-right">
                        <div class="overlay-item">
                            <span class="overlay-label">Zoom:</span>
                            <span class="overlay-value" id="zoom-display">100%</span>
                        </div>
                    </div>
                    
                    <!-- Crosshair -->
                    <div class="crosshair" id="crosshair" style="display: none;">
                        <div class="crosshair-horizontal"></div>
                        <div class="crosshair-vertical"></div>
                    </div>
                </div>
            </div>

            <!-- Right Sidebar - Controls & Information -->
            <div class="right-sidebar">
                <!-- Enhanced Processing Section -->
                <div class="control-section">
                    <h4 class="section-title">ENHANCED PROCESSING</h4>
                    <div class="toggle-controls">
                        <div class="toggle-item">
                            <label>Density</label>
                            <div class="toggle-switch" id="density-toggle">
                                <span class="toggle-slider"></span>
                            </div>
                            <span class="toggle-status" id="density-status">Off</span>
                        </div>
                        <div class="toggle-item">
                            <label>High Res</label>
                            <div class="toggle-switch" id="highres-toggle">
                                <span class="toggle-slider"></span>
                            </div>
                            <span class="toggle-status" id="highres-status">Off</span>
                        </div>
                        <div class="toggle-item">
                            <label>Contrast</label>
                            <div class="toggle-switch" id="contrast-toggle">
                                <span class="toggle-slider"></span>
                            </div>
                            <span class="toggle-status" id="contrast-status">Off</span>
                        </div>
                    </div>
                </div>

                <!-- Window/Level Section -->
                <div class="control-section">
                    <h4 class="section-title">WINDOW/LEVEL</h4>
                    <div class="slider-control">
                        <label>Window Width <span id="window-width-value">400</span></label>
                        <input type="range" id="window-width-slider" min="1" max="4000" value="400" step="1">
                    </div>
                    <div class="slider-control">
                        <label>Window Level <span id="window-level-value">40</span></label>
                        <input type="range" id="window-level-slider" min="-2000" max="2000" value="40" step="1">
                    </div>
                    <div class="preset-buttons">
                        <button class="preset-btn" data-preset="lung">Lung</button>
                        <button class="preset-btn" data-preset="bone">Bone</button>
                        <button class="preset-btn" data-preset="soft">Soft</button>
                        <button class="preset-btn" data-preset="brain">Brain</button>
                    </div>
                </div>

                <!-- Navigation Section -->
                <div class="control-section">
                    <h4 class="section-title">NAVIGATION</h4>
                    <div class="slice-info">
                        <span id="slice-info">Slice 1/1</span>
                    </div>
                    <div class="slice-control">
                        <input type="range" id="slice-slider" min="1" max="1" value="1" step="1">
                        <div class="slice-buttons">
                            <button class="slice-btn" id="prev-slice-btn">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button class="slice-btn" id="next-slice-btn">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Measurements Section -->
                <div class="control-section">
                    <h4 class="section-title">MEASUREMENTS</h4>
                    <div class="measurement-info">
                        <span id="measurement-count">No measurements</span>
                    </div>
                    <button class="clear-btn" id="clear-measurements-btn">
                        <i class="fas fa-trash"></i>
                        Clear All
                    </button>
                </div>

                <!-- Annotations Section -->
                <div class="control-section">
                    <h4 class="section-title">ANNOTATIONS</h4>
                    <div class="annotation-info">
                        <span id="annotation-count">No annotations</span>
                    </div>
                    <button class="clear-btn" id="clear-annotations-btn">
                        <i class="fas fa-trash"></i>
                        Clear All
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loading-text">Loading...</div>
    </div>

    <!-- Upload Modal -->
    <div class="modal" id="upload-modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Upload DICOM Files</h3>
                <button class="modal-close" id="close-upload-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="upload-tabs">
                    <button class="upload-tab active" onclick="switchUploadTab('files')">
                        <i class="fas fa-file"></i>
                        Files
                    </button>
                    <button class="upload-tab" onclick="switchUploadTab('folder')">
                        <i class="fas fa-folder"></i>
                        Folder
                    </button>
                    <button class="upload-tab" onclick="switchUploadTab('network')">
                        <i class="fas fa-network-wired"></i>
                        Network
                    </button>
                </div>
                
                <div class="upload-content">
                    <div id="files-tab" class="upload-tab-content active">
                        <div class="upload-drop-area" id="upload-drop-area">
                            <i class="fas fa-cloud-upload-alt upload-icon"></i>
                            <h4>Drop DICOM files here</h4>
                            <p>or click to browse</p>
                            <div class="upload-formats">
                                <span class="format-tag">DICOM</span>
                                <span class="format-tag">ZIP</span>
                                <span class="format-tag">RAR</span>
                            </div>
                        </div>
                        <input type="file" id="file-input" multiple accept=".dcm,.zip,.rar" style="display: none;">
                    </div>
                    
                    <div id="folder-tab" class="upload-tab-content">
                        <div class="upload-drop-area" id="folder-drop-area">
                            <i class="fas fa-folder-open upload-icon"></i>
                            <h4>Drop folder here</h4>
                            <p>or click to browse folder</p>
                            <p class="folder-info">Supports large CT/MRI files with multiple series</p>
                        </div>
                        <input type="file" id="folder-input" webkitdirectory directory multiple style="display: none;">
                    </div>
                    
                    <div id="network-tab" class="upload-tab-content">
                        <div class="network-options">
                            <div class="network-option">
                                <h5><i class="fas fa-server"></i> PACS Server</h5>
                                <div class="network-form">
                                    <input type="text" placeholder="Server IP" id="pacs-ip">
                                    <input type="text" placeholder="Port" id="pacs-port" value="104">
                                    <input type="text" placeholder="AE Title" id="pacs-ae">
                                    <button class="network-connect-btn" onclick="connectToPACS()">Connect</button>
                                </div>
                            </div>
                            <div class="network-option">
                                <h5><i class="fas fa-cloud"></i> Cloud Storage</h5>
                                <div class="cloud-providers">
                                    <button class="cloud-btn" onclick="connectToCloud('aws')">
                                        <i class="fab fa-aws"></i>
                                        AWS S3
                                    </button>
                                    <button class="cloud-btn" onclick="connectToCloud('azure')">
                                        <i class="fab fa-microsoft"></i>
                                        Azure
                                    </button>
                                    <button class="cloud-btn" onclick="connectToCloud('gcp')">
                                        <i class="fab fa-google"></i>
                                        GCP
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Series Selector -->
    <div class="series-selector" id="series-selector">
        <div class="series-selector-header">
            <h4 class="series-selector-title">Series Selection</h4>
        </div>
        <div class="series-grid" id="series-grid">
            <!-- Series items will be populated here -->
        </div>
    </div>

    <!-- Notifications Container -->
    <div id="notifications-container"></div>

    <!-- JavaScript -->
    <script src="{% static 'js/dicom_viewer.js' %}"></script>
    <script>
        // Initialize the viewer when the page loads
        document.addEventListener('DOMContentLoaded', function() {
            const viewer = new DicomViewer();
            viewer.init();
        });
    </script>
</body>
</html>